
# Automating Re-running Analyses



```{r, fig.align='center', out.width="100%", echo = FALSE }
ottrpal::include_slide("https://docs.google.com/presentation/d/1x0Cnk2Wcsg8HYkmXnXo_0PxmYCxAwzVrUQzb8DUDvTA/edit#slide=id.g280d2b56f79_0_3819")
```

In the beginning of this course we discussed the benefits of using continuous integration/continuous deployment principles for scientific code including analyses.

In this chapter we will go through example code that shows how this can be set up. We highly encourage you to take this code and adapt it to your own project's needs.

## Exercise 2

For this exercise, we are going to continue to use the example repository that we set up in the previous chapter.

1. Create a new branch to work from.

As is good practice for adapting a GitHub workflow, we will create a new branch for us to work from. In GitHub Desktop you can click the branch button and follow the same steps we did in the previous exercise.

```{r, fig.align='center', out.width="100%", echo = FALSE }
ottrpal::include_slide("https://docs.google.com/presentation/d/1x0Cnk2Wcsg8HYkmXnXo_0PxmYCxAwzVrUQzb8DUDvTA/edit#slide=id.g280d2b56f79_0_3213")
```
From command line:
```
`git checkout -b "more-ghas"`
```

2. For this exercise we are going to copy over a second GitHub Action YAML file from the folder. This time, move the `01-re-run-analysis.yml` file to your `.github/workflows` directories you made in the previous chapter.

```{r, fig.align='center', out.width="100%", echo = FALSE }
ottrpal::include_slide("https://docs.google.com/presentation/d/1x0Cnk2Wcsg8HYkmXnXo_0PxmYCxAwzVrUQzb8DUDvTA/edit#slide=id.g280d2b56f79_0_3226")
```
From command line:
```
mv activity-1-sample-github-actions/01-re-run-analysis.yml .github/workflows/01-re-run-analysis.yml
```

3. Now follow the same set of steps we used in the previous chapter to Add, Commit, Push the changes.

```{r, fig.align='center', out.width="100%", echo = FALSE }
ottrpal::include_slide("https://docs.google.com/presentation/d/1x0Cnk2Wcsg8HYkmXnXo_0PxmYCxAwzVrUQzb8DUDvTA/edit#slide=id.g280d2b56f79_0_3234")
```
From command line:
```
git add .github/*
git commit -m "adding more ghas"
git push --set-upstream origin more-ghas
```

4. Now create a pull request with the changes you just made. (Refer to the previous chapter if you need reminders on how to do this).

After you open your pull request, scroll down to the bottom of the page. If all went as expected, you should see a status message that shows a GitHub Action is running after opening your pull request.

```{r, fig.align='center', out.width="100%", echo = FALSE }
ottrpal::include_slide("https://docs.google.com/presentation/d/1x0Cnk2Wcsg8HYkmXnXo_0PxmYCxAwzVrUQzb8DUDvTA/edit#slide=id.g280d2b56f79_0_3239")
```

Think about it.

Without looking at the YAML fileâ€¦ What do you suppose the on: value (the when) might be for these actions?

```{r, fig.align='center', out.width="100%", echo = FALSE }
ottrpal::include_slide("https://docs.google.com/presentation/d/1x0Cnk2Wcsg8HYkmXnXo_0PxmYCxAwzVrUQzb8DUDvTA/edit#slide=id.g280d2b56f79_0_3246")
```

Take a look at the file, `.github/workflows/01-re-run-analysis.yml`, to see if you are right!

5. On your pull request page on GitHub, click on the Details button next to your workflow run.

```{r, fig.align='center', out.width="100%", echo = FALSE }
ottrpal::include_slide("https://docs.google.com/presentation/d/1x0Cnk2Wcsg8HYkmXnXo_0PxmYCxAwzVrUQzb8DUDvTA/edit#slide=id.g280d2b56f79_0_3250")
```

You can navigate to this same page by going to the `Actions` tab, then Scrolling down to see the most recent workflow run which should be named `Re-run analysis` and clicking on that.


### Diving into the details

Let's dive into what is in this GitHub Action YAML file.

Open up the `.github/workflows/01-re-run-analysis.yml` so we can study it. 

```{r, fig.align='center', out.width="100%", echo = FALSE }
ottrpal::include_slide("https://docs.google.com/presentation/d/1x0Cnk2Wcsg8HYkmXnXo_0PxmYCxAwzVrUQzb8DUDvTA/edit#slide=id.g280d2b56f79_0_3262")
```
